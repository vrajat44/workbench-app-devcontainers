services:
  app:
    # The container name must be "application-server"
    container_name: "application-server"
    build:
      context: .
    restart: always
    # Gradio app port
    ports:
      - "8080:8080"
    environment:
      # Metadata loaded from GCS at runtime (no files bundled in image)
      - METADATA_SOURCE=${METADATA_SOURCE:-gs://metadata-json-wb-shrewd-papaya-8403}
      # Data project IDs where BigQuery tables live (space-separated)
      - DATA_PROJECT_IDS=${DATA_PROJECT_IDS:-wb-beamish-acorn-6393 wb-glittery-carrot-8816}
      # LLM model (Vertex AI)
      - LLM_MODEL=${LLM_MODEL:-gemini-2.5-pro}
      # Google ADC is automatically available in Workbench
      - GOOGLE_APPLICATION_CREDENTIALS=${GOOGLE_APPLICATION_CREDENTIALS:-}
    networks:
      - app-network
    # Required by Workbench for resource mounting
    cap_add:
      - SYS_ADMIN
    devices:
      - /dev/fuse
    security_opt:
      - apparmor:unconfined

networks:
  # The Docker network must be named "app-network"
  app-network:
    external: true
